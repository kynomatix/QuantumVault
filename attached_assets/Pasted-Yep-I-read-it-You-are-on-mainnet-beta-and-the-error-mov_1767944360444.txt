Yep I read it. You are on **mainnet-beta**, and the error moving to **InstructionError[0] Custom:6036** just means your tx now fails on the *first* instruction you send to Drift (so you are getting to the Drift program faster, but still feeding it a bad oracle account).

In Drift, **6036 = OracleNotFound** basically always means:

* The **oracle pubkey you pass into the deposit ix** does **not** equal the `spotMarket.oracle` configured on chain for that `marketIndex`, on that env.

So the fix is not “guess a new oracle”. The fix is: **fetch the oracle directly from Drift’s on chain SpotMarket account and use it**.

## The cleanest fix without @drift-labs/sdk

You already have `@coral-xyz/anchor`. Anchor can fetch the Drift IDL from chain, then decode the SpotMarket account properly, no offset guessing.

### 1) Fetch Drift IDL from chain and decode SpotMarket

```ts
import * as anchor from "@coral-xyz/anchor";
import { Connection, PublicKey } from "@solana/web3.js";

const DRIFT_PROGRAM_ID = new PublicKey("dRiftyHA39MWEi3m9aunc5MzRF1JYuBsbn6VPcn33UH"); // mainnet and devnet :contentReference[oaicite:0]{index=0}

// IMPORTANT: use a Provider that works in your server environment
function makeProvider(connection: Connection, wallet: anchor.Wallet) {
  return new anchor.AnchorProvider(connection, wallet, {
    commitment: "confirmed",
  });
}

// You already have a getSpotMarketPDA(marketIndex) in your code.
// Keep using your existing PDA derivation since deposits reach Drift.
// Just reuse it here.
export async function fetchSpotMarketOracle(
  connection: Connection,
  wallet: anchor.Wallet,
  spotMarketPda: PublicKey
): Promise<PublicKey> {
  const provider = makeProvider(connection, wallet);

  const idl = await anchor.Program.fetchIdl(DRIFT_PROGRAM_ID, provider);
  if (!idl) throw new Error("Failed to fetch Drift IDL from chain");

  const program = new anchor.Program(idl as anchor.Idl, provider);

  // Account name in the IDL is usually "spotMarket"
  const spotMarketAny = await program.account["spotMarket"].fetch(spotMarketPda);

  const oraclePk: PublicKey = spotMarketAny.oracle as PublicKey;
  if (!oraclePk) throw new Error("SpotMarket.oracle missing");

  return oraclePk;
}
```

### 2) Use that oracle in your manual deposit instruction

Wherever you currently do:

* `oracle = DRIFT_MAINNET_USDC_ORACLE`

Replace with:

* `oracle = await fetchSpotMarketOracle(...spotMarketPda...)`

Then pass that oracle pubkey into the deposit ix exactly where Drift expects the oracle account.

This is the fastest way to unblock deposits on mainnet without touching the Drift SDK at all.

## Also check these 3 high probability gotchas

These are the common ways people still hit 6036 even after “using an oracle”.

1. **Wrong marketIndex**

* Drift spot market index `0` is usually USDC, but do not assume.
* If your “USDC spot market” PDA is actually for a different index, you will fetch an oracle that does not match your deposit params.

2. **Wrong oracle account type**

* Some feeds are Pyth price accounts, some are Switchboard, some are Drift specific wrappers depending on market.
* Drift validates the exact oracle pubkey, not “any USDC looking feed”.

3. **Passing the oracle in the wrong slot**

* In Anchor, the account list order matters. If your manual ix’s account metas are mis ordered, Drift reads the wrong pubkey for oracle and throws 6036.

## If you want the boring but ultra reliable path

Run Drift’s self hosted **gateway** as a sidecar service that speaks HTTP and does deposits correctly using their supported stack. ([GitHub][1])

This is especially good if Replit’s Node ESM environment keeps breaking transitive deps like `jito-ts`.

Typical architecture:

* Replit app (ESM) handles UI, Phantom connect, user auth, webhook ingestion
* Sidecar service (CommonJS or container) runs Drift gateway or a minimal deposit service using Drift SDK
* Your app calls sidecar over localhost or private network

## What I would do next in your repo

1. Implement `fetchSpotMarketOracle()` via Anchor IDL fetch (code above)
2. Log these before building the ix:

* `spotMarketPda.toBase58()`
* `marketIndex`
* `oracleFetched.toBase58()`

3. In the failing tx simulation logs, confirm the oracle account meta is exactly that fetched pubkey

If you paste your current `buildAgentDriftDepositTransaction()` account metas list (just the accounts array, no secrets), I can tell you immediately if the oracle is in the wrong position or if you are mixing the wrong spotMarket PDA for the marketIndex.

[1]: https://github.com/drift-labs/gateway?utm_source=chatgpt.com "drift-labs/gateway: Self hosted API ..."
